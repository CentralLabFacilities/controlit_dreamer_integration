header:
  version: 2
  description: Dreamer right hand Cartesian position control
tasks:
  - name: RightHandPosition
    type: controlit/CartesianPositionTask  # must match class name in sensor_plugins.xml
    parameters:
      - name: kp
        type: vector
        value: 64
      - name: kd
        type: real
        value: 3
      - name: maxVelocity
        type: real
        value: 1000
      - name: bodyName  # the coordinate frame of the current position
        type: string
        value: right_wrist_yaw
      - name: frameName  # the coordinate frame of the goal heading
        type: string
        value: world
      - name: latchOn
        type: real
        value: 0
      - name: resetLatch
        type: real
        value: 0
      - name: goalPosition      # in frameName's frame
        type: vector

        # these are the values used by UTA-WBC
        value: [0.45, -0.25, 1.1]

        # measured Cartesian position when right hand is forward slightly
        i# value: [0.129, -0.192, 0.795]

        # these are the Cartesian coordinates when all joints are close to zero:
        # value: [0.05910914740914856, -0.20988127817117105, 0.7879616040106433]   # from this task
        # value: [0.02906213214429017, -0.19761038391020588, 0.7851485590826267] # from a sensor
        # value: [0.075, -0.35, 1.25]
      - name: goalVelocity           # in frameName's frame
        type: vector
        value: [0.0, 0.0, 0.0]
      - name: controlPoint
        type: vector
        value: [0.0, 0.0, 0.0] #in bodyName's  frame
      - name: projection
        type: matrix
        value: [[1, 0, 0],
                [0, 1, 0],
                [0, 0, 1]]
  - name: JPosTask     # Arbitrary instance name
    type: controlit/JointPositionTask # Must Match the NAME of the task in the task_library
    parameters:
      - name: kp
        type: vector

        # value: [20.0, 20.0,                                 # torso
        #         20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0,   # left arm 
        #         20.0, 20.0, 20.0, 20.0, 20.0, 20.0, 20.0]   # right arm

        # these are the values used by UTA-WBC
        value: [30.0, 30.0,                                 # torso
                30.0, 30.0, 30.0, 20.0, 20.0, 30.0, 30.0,   # left arm 
                30.0, 30.0, 30.0, 20.0, 20.0, 30.0, 30.0]   # right arm

      - name: kd
        type: vector

        # value: [1, 1,                  # torso
        #         1, 1, 1, 1, 1, 1, 1,   # left arm
        #         1, 1, 1, 1, 1, 1, 1]   # right arm

        # these are the values used by UTA-WBC
        value: [3, 3,                  # torso
                3, 3, 3, 3, 3, 3, 3,   # left arm
                3, 3, 3, 3, 3, 3, 3]   # right arm

      - name: maxVelocity
        type: vector
        value: [1000, 1000,                                  # torso
                1000, 1000, 1000, 1000, 1000, 1000, 1000,    # left arm 
                1000, 1000, 1000, 1000, 1000, 1000, 1000]    # right arm

      - name: goalPosition
        type: vector

        # value: [0.0, 0.0,                                # torso
        #         0.0, 0.0, 0.0, 0.3, 0.0, 0.0, 0.0,       # left arm
        #         0.0, 0.0, 0.0, 0.3, 0.0, 0.0, 0.0]       # right arm

        # these are the values used by UTA-WBC
        value: [0.0, 0.0,                                # torso
                0.0, 0.0, 0.0, 1.57, 0.0, 0.0, 0.0,      # left arm
                0.0, 0.0, 0.0, 1.57, 0.0, 0.0, 0.0]      # right arm

      - name: goalVelocity
        type: vector
        value: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

      - name: goalAcceleration
        type: vector
        value: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

      - name: maxAcceleration
        type: real
        value: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

      - name: error
        type: vector
        value: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

      - name: errorDot
        type: vector
        value: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

    events:
      - name: converged
        expression: errorNorm < 55e-4 #err is a norm...it is positive
      - name: quiescent
        expression: errorDotNorm < 3e-2 #absolute value take in code
compound_task:
  type: compound_task
  name: My compound task
  events:
    - name: converged
      expression: JPosTask.converged and JPosTask.quiescent
  task_list:
     - name: RightHandPosition
       priority: 0
       enabled: 1
     - name: JPosTask
       priority: 1
       enabled: 1
constraints:
  - name: ContactConstraint
    type: controlit/FlatContactConstraint
    parameters:
      - name: masterNodeName
        type: string
        value: "rigid6DoF"
      - name: contactPoint
        type: vector
        value: [0, 0, 0]
      - name: enabled
        type: integer
        value: 1
  - name: TorsoTransmission
    type: controlit/TransmissionConstraint
    parameters:
      - name: masterNodeName
        type: string
        value: "torso_lower_pitch"
      - name: slaveNodeName
        type: string
        value: "torso_upper_pitch"
      - name: transmissionRatio
        type: float
        value: 1.0
constraint_set:
  type: constraint_set
  name: My Constraint Set
  active_constraints:
    - name: ContactConstraint
      enabled: 1
    - name: TorsoTransmission
      enabled: 1
